<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        @page {
            margin: 2cm 1.5cm 2.5cm 1.5cm;
        }
        body {
            font-family: DejaVu Sans, sans-serif;
            font-size: 9pt;
            line-height: 1.3;
            color: #000000;
            margin: 0;
            padding: 0;
        }
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #000000;
        }
        h1 {
            margin: 0 0 5px 0;
            font-size: 18pt;
            font-weight: bold;
        }
        .subtitle {
            font-size: 9pt;
            margin: 3px 0;
        }
        .info-box {
            margin-bottom: 15px;
            padding: 8px;
            border: 1px solid #000000;
            font-size: 8pt;
        }
        .month-section {
            margin-bottom: 15px;
            page-break-inside: auto;
        }
        .month-header {
            background-color: #000000;
            color: #ffffff;
            padding: 6px 10px;
            font-size: 11pt;
            font-weight: bold;
            margin-bottom: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        th {
            background-color: #e0e0e0;
            padding: 5px 6px;
            text-align: left;
            font-weight: bold;
            font-size: 8pt;
            border: 1px solid #000000;
        }
        td {
            padding: 5px 6px;
            border: 1px solid #cccccc;
            font-size: 8pt;
            vertical-align: top;
        }
        tbody tr:nth-child(even) {
            background-color: #f5f5f5;
        }
        .date-col {
            font-weight: bold;
        }
        .child-col {
            font-weight: 600;
        }
        .parent-col {
            font-size: 7.5pt;
        }
        .type-manual {
            font-weight: bold;
        }
        .footer-space {
            height: 2cm;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Kochplan {{ kitaYear.yearString }}</h1>
        <div class="subtitle">
            Zeitraum: {{ kitaYear.startDate|date('d.m.Y') }} bis {{ kitaYear.endDate|date('d.m.Y') }}
        </div>
        <div class="subtitle">
            Gesamt: {{ totalAssignments }} Kochdienste | Erstellt: {{ "now"|date('d.m.Y, H:i') }} Uhr
        </div>
    </div>

    {% for month in assignmentsByMonth %}
    <div class="month-section">
        <div class="month-header">{{ month.name }}</div>
        
        <table>
            <thead>
                <tr>
                    <th style="width: 12%;">Datum</th>
                    <th style="width: 8%;">Tag</th>
                    <th style="width: 35%;">Familie (Kind)</th>
                    <th style="width: 40%;">Eltern</th>
                    <th style="width: 5%;">Typ</th>
                </tr>
            </thead>
            <tbody>
                {% for assignment in month.assignments %}
                <tr>
                    <td class="date-col">{{ assignment.assignedDate|date('d.m.Y') }}</td>
                    <td>
                        {% set day = assignment.assignedDate|date('l') %}
                        {% if day == 'Monday' %}Mo
                        {% elseif day == 'Tuesday' %}Di
                        {% elseif day == 'Wednesday' %}Mi
                        {% elseif day == 'Thursday' %}Do
                        {% elseif day == 'Friday' %}Fr
                        {% elseif day == 'Saturday' %}Sa
                        {% elseif day == 'Sunday' %}So
                        {% endif %}
                    </td>
                    <td class="child-col">{{ assignment.party.childrenNames }}</td>
                    <td class="parent-col">{{ assignment.party.parentNames|join(', ') }}</td>
                    <td style="text-align: center;">
                        {% if assignment.isManuallyAssigned %}
                            <span class="type-manual">M</span>
                        {% else %}
                            A
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}

    <script type="text/php">
        if (isset($pdf)) {
            $font = $fontMetrics->getFont("DejaVu Sans");
            $size = 7;
            $pageText = "Seite " . $PAGE_NUM . " von " . $PAGE_COUNT . " | Kochplan {{ kitaYear.yearString }} | Erstellt: {{ "now"|date('d.m.Y, H:i') }} Uhr";
            $y = $pdf->get_height() - 30;
            $x = $pdf->get_width() / 2 - $fontMetrics->getTextWidth($pageText, $font, $size) / 2;
            $pdf->page_text($x, $y, $pageText, $font, $size, array(0, 0, 0));
        }
    </script>
</body>
</html>
